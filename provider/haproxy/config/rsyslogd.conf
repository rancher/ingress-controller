module(load="imudp")
input(type="imudp" port="8514")
module(load="imuxsock")
input(type="imuxsock" Socket="/var/lib/haproxy/dev/log")
template(name="FileFormat" type="string"
         string= "%TIMESTAMP% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n"
        )
module(load="builtin:omfile" template="FileFormat")

/* info */
if $programname startswith 'haproxy' and $syslogseverity == 6 then {
	action(type="omfile" file="/var/log/haproxy/traffic" flushOnTXEnd="off" asyncWriting="on")
	stop
}
/* error */
if $programname startswith 'haproxy' and $syslogseverity-text == 'err' then {
	action(type="omfile" file="/var/log/haproxy/errors" flushOnTXEnd="off" asyncWriting="on")
	stop
}
/* notice */
if $programname startswith 'haproxy' and $syslogseverity <= 5 then {
	action(type="omfile" file="/var/log/haproxy/events" flushOnTXEnd="off" asyncWriting="on")
	stop
}

*.* /var/log/messages
